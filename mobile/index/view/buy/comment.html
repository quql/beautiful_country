<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"/>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <!--<link rel="stylesheet" href="/static/mobile/css/amazeui.min.css">-->
    <!--<link rel="stylesheet" href="/static/mobile/css/wap.css">-->
    <link href="/static/app/index/css/bootstrap.min.css" rel="stylesheet">
    <script src="/static/app/index/js/jquery-1.8.3.min.js"></script>
    <title>我的评论</title>
    <style>
        body{
            width: 100%;
        }
        .head{
            width: 100%;
            height: 50px;
            background-color: lightskyblue;
            color: white;
            text-align: left;
            line-height: 50px;
            padding-left: 20px;
        }
        form{
            padding: 20px;
        }
        .span1{
            display: block;
            float: left;
        }
        .span2{
            display: block;
            float: right;
            padding-right: 20px;
        }
        ul{
            padding: 20px;
        }
        li{
            display: inline-block;
            margin-right: 20px;
        }
    </style>
</head>
<body>
<div class='head'>
    <span class="span1">我的评论</span>
    <a href="{:url('index/personal/index')}"><span class="span2">返回</span></a>
</div>

<!--评论列表-->

<div class="col-md-8" id="comment" style="display: none;background-color: white">
    {if condition="!empty($comment)"}
    <div class="row">
        <table class="table table-striped">
            <caption style="text-align: center"><h3>我的评论列表</h3></caption>
            <tr>
                <th style="text-align: center">消费产品</th>
                <th style="text-align: center">评论内容</th>
                <th style="text-align: center">评论时间</th>
                <th style="text-align: center">评分</th>
                <th style="text-align: center">商家回应</th>
                <th style="text-align: center" class="col-sm-1">操作</th>
            </tr>
            {volist name="comment" id="vp"}
            <tr >
                <td style="text-align: center"><a href="{:url('/goodsdetail',['id'=>$vp.c_gid,'bus_id'=>$vp.c_bid,'cid'=>$vp.c_cid])}">{$vp['c_gname']}</a></td>
                <td style="text-align: center">
                    {$vp['c_text']}
                    <!--<textarea name="text" id="" cols="30" rows="3">{$vp['c_text']}</textarea>-->
                </td>
                <td style="text-align: center">{$vp['c_time']}</td>
                <td style="text-align: center">
                    {switch name=$vp['c_score']}
                    {case value="1"}<span class="glyphicon glyphicon-star"></span>{/case}
                    {case value="2"}<span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span>{/case}
                    {case value="3"}<span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span>{/case}
                    {case value="4"}<span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span>{/case}
                    {case value="5"}<span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span><span class="glyphicon glyphicon-star"></span>{/case}
                    {default /}default
                    {/switch}
                </td>
                <td style="text-align: center">
                    {if condition="!empty($vp['c_content'])"}
                    {$vp['c_content']}<br>回应时间:{$vp['c_atime']}
                    {else/}
                    商家尚未回应此评论哦
                    {/if}
                </td>
                <td style="text-align: center">
                    <button class="btn btn-info btn-sm updatecom" com-id="{$vp['c_id']}" data-toggle="modal" data-target="#myCommentModal1">修改</button>
                    <button class="btn btn-danger btn-sm deletecom" com-id="{$vp['c_id']}">删除</button>
                </td>
            </tr>
            {/volist}
        </table>
    </div>
    {else/}
    <h5 style="text-align: center"> 您还没有写过任何点评哦O(∩_∩)O </h5>
    {/if}
</div>

<!--修改评价-->
<div class="modal fade" id="myCommentModal1" tabindex="-1" role="dialog" >
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="gname2"></h4>
            </div>
            <form action="{:url('index/Comment/update')}"  method="post" enctype="multipart/form-data">
                <div class="modal-body">
                    <input type="hidden" name="c_id" value="" id="c-id">
                    <textarea class="content" name="text"  cols="75" rows="3" placeholder="请输入评论内容,长度限制在140个字符以内" maxlength="140" noresize></textarea>
                    <br>
                    <br>
                    评分:　
                    <input type="radio" name='score' value="5" id="sc5">非常好∩_∩
                    　<input type="radio" name='score' value="4" id="sc4">很好^_^
                    　<input type="radio" name='score' value="3" id="sc3">好:-D
                    　<input type="radio" name='score' value="2" id="sc2">一般-_-
                    　<input type="radio" name='score' value="1" id="sc1">差╯﹏╰
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary reload">修改</button>
                </div>
            </form>
        </div>
    </div>
</div>
    <script src="/static/app/index/js/jquery.js"></script>
    <script src="/static/app/index/js/bootstrap.js"></script>
    <script src="/static/app/index/js/toastr.min.js"></script>
    <!--<script src="/static/mobile/js/jquery.min.js"></script>-->
    <!--<script src="/static/mobile/js/amazeui.min.js"></script>-->
    <script>
        $(function() {
            //      优惠券
            $('#up').click(function () {
                if ($('#num').val() >= 99) {
                    $('#num').val(99);
                }
                $('#num').val() + 1;
                var n = parseInt($('#num').val()) + 1;
                var t = $('#choosePoint').val() * n;
                $('#total').html(t);
//            console.log($('#total').html(t));
            });
            $('#back').click(function () {
                alert('尚未添加收货地址,请去个人中心完善');
            });


            $('#down').click(function () {
                if ($('#num').val() <= 1) {
                    $('#num').val(1);
                }
                $('#num').val() - 1;
                var n = parseInt($('#num').val()) - 1;
                var t = $('#choosePoint').val() * n;
                $('#total').html(t);
//            console.log($('#total').html(t));

            });

            $('#choosePoint').change(function () {
                var n = parseInt($('#num').val());
                var t = $('#choosePoint').val() * n;
                $('#total').html(t);
//            console.log(n);
//            console.log(t);
            });

//        优惠券模态框点击确认
            $('#yes').click(function () {
                if (parseInt($('#total').html()) > parseInt($('#point').html())) {
                    alert('您的积分不足哦');
                } else {
//               用户id
                    var id = $('#userid').html();
//               用户在输入框输入的值
//               var text = prompt("请输入您的账户密码","password");
//               用户选择的优惠券类型
                    var type = parseInt($('#choosePoint').val());
//               优惠券数量
                    var n = parseInt($('#num').val());
//               消耗的总积分
                    var total = parseInt($('#total').html());
//               console.log(id, typeof(id));
//               console.log(type, typeof(type));
//               console.log(n, typeof(n));
//               console.log(total, typeof(total));
                    checkpass(id, type, n, total);
                }
            });

            function checkpass(id, type, n, total) {
                $.ajax({
                    type: 'post',
                    url: "/money",
                    data: {
                        "id": id,
//                    "pass":text,
                        "type": type,
                        "n": n,
                        "total": total
                    },
                    dataType: 'json',
                    success: function (data) {
//                    console.log(data);
                        if (data.status) {
                            alert('优惠券兑换成功');
                            history.go(0);
                        } else {
                            alert('优惠券兑换失败,请重试');
                        }
                    },
                    error: function () {
                        alert('优惠券兑换失败,请重试');
                    }
                });
            }
        });


    </script>
<script>

    //    计算总价
        $(function(){
//            加
            $('.plus').click(function(){
//                数量
               var num = $(this).parent().prev();
               num.text(parseInt(num.val()+1));
//               setTotal();
//                单价
               var p = parseInt($(this).parents('tr').children('.price').text());
////                总价
//                var t = num.text()*p;
                $('#total').text(parseInt($('#total').text()) + p);
               console.log(t);
            });

//            减
            $('.minus').click(function(){
                var num = $(this).parent().prev();
                if(parseInt(num.val()) <= 1){
                    num.val(1);
                }else{
                    num.text(parseInt(num.val()-1));
//                    setTotal();
                    var p = parseInt($(this).parents('tr').children('.price').text());
                    $('#total').text(parseInt($('#total').text()) - p);
                }
            });


//    执行删除
        $('.del').click(function(){
            var gid = $(this).attr('data-id');
            console.log(gid);

            if (confirm('您确定要狠心删除我吗?(Ｔ▽Ｔ)')){
                var obj = $(this).parents('tr');
                // console.log(obj);
                delAjax(gid, obj);
            }
        });

//    执行ajax删除
        function delAjax(id, obj){
            $.ajax({
                type: 'get',
                url: "/deletecart/"+id,
                dataType:'json',
                success:function(data){
                    console.log(data);
                    if (data.status){
                        obj.remove();
                        alert('O(∩_∩)O~~商品删除成功');
                    }else{
                        alert('(╯﹏╰）商品删除失败,请重试~');
                    }
                },
                error:function(){
                    alert('删除失败,请重试~');
                }
            });
        }


//        function check(){
//            var v = $('input:[name="aid"]:checked').val();
//            if (v == null){
//                alert("收货地址不能为空哦~");
//                return false;
//            }
//            return true;

//            if($("input[name='aid']:checked").size()==0){
//                alert("收货地址不能为空哦~");
//                return false;
//            }else{
//                return true;
//            }

//            if($(".rid").is(':checked')) {
//                return true;
//            }else{
//                return false;
//            }

//              if($('.rid').is(':checked')){
//                return true;
//            }else{
//                return false;
//            }

//        }


    });
</script>
<script>
    //    提交订单时 判断是否有商品被选中
    function checkMsg(){
        if($(".choose").is(':checked')){
            return true;
        }else{
            alert('请选择要购买的商品');
            return false;
        }

    }
</script>

</body>
</html>
