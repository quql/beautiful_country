{extend name="index/index"}
{block name="main"}

    <!--Main Content Wrap Start-->
    <div class="gt_content_wrap">
      <!--Login & Register Page Wrap Start-->
      <section>
        <div class="container">
          <div class="gt_lgin_tab_wrap">
            <ul class="gt_login_link"  data-tabs="tabs">
              <li class="active"><a data-toggle="tab" href="#register">注册</a></li>
              <li><a data-toggle="tab" href="#login">登录</a></li>
            </ul>
            <div class="tab-content">
              <div class="tab-pane active" id="login">
                <div class="gt_login_des_wrap default_width">

                  <!--用户登录表单-->
                  <form method="post" action="{:url('index/Login/dologin')}" onsubmit="return checklogin()">


                      <div class="gt_login_field">
                        <input type="text" name="u_username" id="sub11" placeholder="用户名" onblur="sub1()">
                        <label><i class="fa fa-user"></i></label>
                        <span class="subscript" id="sub1"></span>
                      </div>


                      <div class="gt_login_field">
                        <input type="password" name="u_password" id="sub22" placeholder="密码" onblur="sub2()">
                        <label><i class="fa fa-lock"></i></label>
                        <span class="subscript" id="sub2"></span>
                      </div>

                      <div class="gt_login_field">
                        <input type="text" name="vcode" id="sub33" placeholder="请输入验证码" onblur="sub3()">
                        <label><i class="glyphicon glyphicon-record"></i></label>
                        <div id="v_container" style="display:inline-block;width:120px;height:30px;"></div><br>
                        <span class="subscript" id="sub3"></span>
                      </div>

                      <div class="gt_login_field">
                        <input type="submit" value="登录">
                      </div>
                  </form>

                  <div class="gt_login_field">
                    <p>——————————其他方式登录——————————</p>
                    <ul class="gt_scl_icon">
                      <li><a class="bg_fb" href="https://graph.qq.com/oauth2.0/authorize?response_type=code&client_id=101416221&redirect_uri=http://qqlong.top/qqlogin"><i class="fa fa-qq"></i></a></li>
                    </ul>
                  </div>
                </div>
              </div>
              <div class="tab-pane" id="register">
                <div class="gt_login_des_wrap default_width">
                 <!--用户注册表单-->
                <form method="post" action="{:url('index/Register/doRegister')}" onsubmit="return checkregister()">
                  <div class="gt_login_field">
                    <input type="text" name="u_username" id="sub44" placeholder="用户名" onblur="sub4()">
                    <label><i class="fa fa-user"></i></label>
                     <span class="subscript" id="sub4"></span>
                  </div>

                  <div class="gt_login_field form-inline ">
                    <input type="text" name="u_phone" id="sub55" placeholder="手机号码" onblur="sub5()">
                    <label><i class="fa fa-phone"></i></label>
                    <button id="msmbtn" type="button" style="display: inline-block;width: 100px; height:405x;"class="">获取验证码</button>
                    <span class="subscript" id="sub5"></span>
                  </div>

                  <div class="gt_login_field">
                    <input type="text" name="msmcode" id="sub66" placeholder="请输入验证码" onblur="sub6()">
                    <label><i class="glyphicon glyphicon-unchecked"></i></label>
                     <span class="subscript" id="sub6"></span>
                  </div>



                  <div class="gt_login_field">
                    <input type="password" name="u_password" id="sub77" placeholder="请输入密码" onblur="sub7()">
                    <label><i class="icon-lock"></i></label>
                    <span class="subscript" id="sub7"></span>
                  </div>
                  <div class="gt_login_field">
                    <input type="password" name="repassword" id="sub88"  placeholder="请再次输入密码" onblur="sub8()">
                    <label><i class="icon-lock"></i></label>
                    <span class="subscript" id="sub8"></span>
                  </div>
                  <div class="gt_login_field">
                    <input type="submit" value="注册">
                  </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>

      </section>
      <!--Login & Register Page Wrap End-->
    </div>
    <!--Main Content Wrap End-->

{/block}

{block name="myjs"}
  <script src="http://www.jq22.com/jquery/jquery-1.10.2.js"></script>
  <!--Bootstrap core JavaScript-->
  <script src="http://www.jq22.com/jquery/bootstrap-3.3.4.js"></script>
  <!--Custom JavaScript-->
  <script src="js/custom.js"></script>

  <script type="text/javascript">

    //用户登录的表单验证

  //登录表单
  //1.用户名合法性验证
  function sub1(){
    var sub11=$("#sub11").val();
    if (/^\w{4,12}$/.test(sub11)){
      $('#sub1').html('√用户名格式正确');
      $('#sub1').css('color','green');
      return true;
    }else{
      $('#sub1').html('× 请输入4-12位的数字、字母或下划线组成的名字');
      $('#sub1').css('color','red');
      return false;
    }
  }; 

  //2.密码合法性验证
  function sub2(){
    var sub22=$("#sub22").val();
    if (/^\w{6,12}$/.test(sub22)){
      $('#sub2').html('√密码格式正确');
      $('#sub2').css('color','green');
      return true;
    }else{
      $('#sub2').html('× 请输入6-12位的数字、字母或下划线组成的密码');
      $('#sub2').css('color','red');
      return false;
    }
  }; 

  //3.验证码合法性验证
  var verifyCode = new GVerify("v_container");

  function sub3(){
    // alert(111);
    var res = verifyCode.validate(document.getElementById("sub33").value);
    // alert(res);
      if(res){
        $('#sub3').html('√验证码正确');
        $('#sub3').css('color','green');
        return true;
      }else{
        $('#sub3').html('×验证码错误');
        $('#sub3').css('color','red');
        return false;
      }
  }; 

  function checklogin()
{
    if(sub1() && sub2() && sub3())
    {
        return true;
    }else{
        return false;
    }
}

  //注册表单
  //4.用户名合法性验证
    function sub4(){
    var sub44=$("#sub44").val();
    if (/^\w{4,12}$/.test(sub44)){
      $('#sub4').html('√用户名格式正确');
      $('#sub4').css('color','green');
      return true;
    }else{
      $('#sub4').html('× 请输入4-12位的数字、字母或下划线组成的名字');
      $('#sub4').css('color','red');
      return false;
    }
  }; 

  //5.手机号码的合法性验证
    function sub5(){
    var sub55=$("#sub55").val();
    if (/^1(3|4|5|7|8)[0-9]\d{8}$/.test(sub55)){
      $('#sub5').html('√手机格式正确');
      $('#sub5').css('color','green');
      return true;
    }else{
      $('#sub5').html('× 手机格式不正确');
      $('#sub5').css('color','red');
      return false;
    }
  }; 

   //7.密码的合法性验证
  function sub7(){
    sub77=$("#sub77").val();
    if (/^\w{6,12}$/.test(sub77)){
      $('#sub7').html('√密码格式正确');
      $('#sub7').css('color','green');
      return true;
    }else{
      $('#sub7').html('× 请输入6-12位的数字、字母或下划线组成的密码');
      $('#sub7').css('color','red');
      return false;
    }
  }; 

  //8.密码的一致性验证
  function sub8(){
    sub88=$("#sub88").val();
    if (sub77== sub88){
      $('#sub8').html('√两次输入一致');
      $('#sub8').css('color','green');
      return true;
    }else{
      $('#sub8').html('× 两次输入不一致');
      $('#sub8').css('color','red');
      return false;
    }
  }; 

  </script>

  <!--短信验证-->
  <script type="text/javascript">

    function checkPhone(){
    var phone = document.getElementById('sub55').value;
       if(!(/^1[34578]\d{9}$/.test(phone))){
           return false;
       }else{
           return true;
       }
    }

    var btn1 = document.getElementById('msmbtn');
       btn1.onclick = function(){
           if(!checkPhone()){
               return false;
           }
           var  phone = document.getElementById('sub55').value;
           m=60;
           showbtn();
           send(phone);
      }

    function showbtn() {
       var  btn1 = document.getElementById('msmbtn');
       if (m <= 0) {
           btn1.disabled = false;
           btn1.innerHTML = '重新获取';
           return;
       }
       btn1.innerHTML = '重新获取('+m+')';
       btn1.disabled =true;
       m--;
       setTimeout("showbtn()", 1000);
    }

  sendsmscode ='adsfdxgfhcvjbknbvjhgfsASdsfdghjkl';

  //AjAX请求发送验证码
  function send(phone){
    // console.log(phone);
   $.ajax({
      type:'get',
       url:'/sendmsg/'+phone,
       dataType: 'json',
       success:function(data){
          if(data.status){
              sendsmscode=data['string'];
              alert('短信发送成功');
          }else{
              alert('系统错误,请重试');
          }
       },
       error:function(){
           alert('AJAX请求失败');
       }
    });
  }

  //6.短信验证码的合法性验证
  function sub6(){
  var smscode =document.getElementById('sub66').value;
  if(smscode==sendsmscode){
    $('#sub6').html('√短信验证码正确');
    $('#sub6').css('color','green');
    return true;
  }else{
    $('#sub6').html('×短信验证码错误');
    $('#sub6').css('color','red');
    return false;
  }
}; 

  function checkregister()
    {
      if(sub4() && sub5() && sub6() && sub7() && sub8())
      {
          return true;
      }else{
          return false;
      }
    }

  </script>

  {/block}