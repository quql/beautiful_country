{extend name="index/index"}

{block name="main"}
<!--Sub Banner Wrap Start -->
    <div class="gt_sub_banner_bg default_width">
        <div class="container">
            <div class="gt_sub_banner_hdg  default_width">
                <h2>我的购物车</h2>
                <h6>欢迎来到还没名字的网站~</h6>
            </div>
        </div>
    </div>
    <!--Sub Banner Wrap End -->
    <!--Breadcrumb Wrap End -->
    <div class="gt_breadcrumb_bg default_width">
        <div class="container">
            <div class="gt_breadcrumb_wrap default_width">
                <ul>
                    <li><a href="{:url('index/index/index')}">首页</a></li>
                    <li><a href="{:url('index/cart/index')}">购物车</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!--Breadcrumb Wrap End -->
    <div class="gt_main_content_wrap">
        <!--Shop Wrap Start-->
        <section class="gt_shop_detail_bg gt_courses_bg">
            <div class="container">
                <table class="table table-hover " id="mytable">
                    <tr>
                        <th style="text-align: center;"></th>
                        <th style="text-align: center;">商品图片</th>
                        <th style="text-align: center;">商品名称</th>
                        <th style="text-align: center;">商品类别</th>
                        <th style="text-align: center;">单价 (元)</th>
                        <th class="col-sm-2" style="text-align: center;">数量</th>
                        <th style="text-align: center;">总价 (元)</th>
                        <th style="text-align: center;">操作</th>
                    </tr>
                    <tr>
                        <td style="text-align: center;line-height: 62px;">1</td>
                        {volist name="photo" id="p"}
                        <td style="text-align: center;line-height: 62px;">
                            <img src="/uploads/{$p['p0']}" class="img-rounded" alt="" width="100" height="56">
                        </td>
                        {/volist}
                        {volist name="res" id="r"}
                        <td style="text-align: center;line-height: 62px;">{$r['gd_title']}</td>
                        <td style="text-align: center;line-height: 62px;">{$cate}</td>
                        {/volist}
                        {volist name="data" id="d"}
                        <td style="text-align: center;line-height: 62px;" id="price">{$d['ca_price']}</td>
                        <form action="index/order/index" method="post">
                            <!--传递用户id-->
                            <input type="hidden" name="uid" value="{$data[0]['ca_uid']}">
                            <!--商品id-->
                            <input type="hidden" name="gid" value="{$data[0]['ca_gdid']}">
                            <!--商品单价-->
                            <input type="hidden" name="price" value="{$data[0]['ca_price']}">
                            <p style="display: none" id="base">{$point}</p>
                            <!--总积分-->
                            <input type="hidden" name="point" id="point">
                        <td style="text-align: center;">
                            <div class="gt_product_left_wrap" style="border-bottom: none;margin-left: 0px;margin: 8px 0px -12px">
                                <div id="incdec" style="margin-left: 54px;">
                                    <!--传递数量-->
                                    <input type="text" value="{$d['ca_num']}" readonly="readonly" id="num" name="num"/>
                                    <div class="gt_increment">
                                        <button type="button" id="up" >+</button>
                                        <button type="button" id="down" > -</button>
                                    </div>
                                </div>
                            </div>
                        </td>
                            <input type="hidden" name="total" id="passtotal">
                        <td style="text-align: center;line-height: 62px;" id="total"></td>
                        <td style="text-align: center;line-height: 62px;">
                            <button type="button" class="btn btn-danger glyphicon glyphicon-trash" data-id="{$cid}" id="del"></button>
                        </td>
                    </tr>
                    {/volist}
                </table>
                <div style="margin-left: 850px">
                        <a class="btn btn-info btn-lg ml30">再去逛逛</a>
                        <button type="submit" class="btn btn-success btn-lg ml30" id="settle">去结算</button>
                    </form>
                </div>
            </div>
            <!--Content Wrap Start-->
        </section>
    </div>

    <!--Content Wrap End-->
{/block}

{block name="myjs"}
{js href="/static/app/index/js/toastr.min.js"}
<script>

    //    计算总价
        $(function(){
//        console.log($('#price').html());
//        console.log($('#num').val());
        var num = $('#price').html()*$('#num').val();
        num = num.toFixed(2)
        $('#total').html(num);
        $('#passtotal').val(num);
//        计算积分
        var p1 = $('#base').html()*$('#num').val();
        $('#point').val(p1);
//        console.log($('#total').html(num));

        //    点击改变数量
        $('#up').click(function(){
            if($('#num').val() >= 99){
                $('#num').val(99);
            }else{
                $('#num').val() + 1;
            }
            var n = parseInt($('#num').val());
//        console.log(n);
            var t = $('#price').html()*n;
//        console.log(t);
            t = t.toFixed(2);
            $('#total').html(t);
            $('#passtotal').val(t);
//            console.log($('#passtotal').val());
            var p = $('#base').html();
            var point = p*n;
            $('#point').val(point);
//            console.log(point);
        });


        $('#down').click(function(){
            if($('#num').val() <= 1){
                $('#num').val(1);
            }else{
                $('#num').val() - 1;
            }
            var n = parseInt($('#num').val());
//            console.log(n);
            var t = $('#price').html()*n;
            t = t.toFixed(2);
            $('#total').html(t);
            $('#passtotal').val(t);
//            console.log($('#passtotal').val());
            var p = $('#base').html();
            var point = p*n;
            $('#point').val(point);
//            console.log(point);

        });

//    执行删除
        $('#del').click(function(){
            var gid = $(this).attr('data-id');
            console.log(gid);

            if (confirm('您确定要狠心删除我吗?(Ｔ▽Ｔ)')){
                var obj = $(this).parents('tr');
                // console.log(obj);
                delAjax(gid, obj);
            }
        });

        // 设置弹框参数
        toastr.options = {
            closeButton: true,//是否显示关闭按钮
            progressBar: true,//实现显示计时条
            timeOut: "3000",//自动关闭时间
            positionClass: "toast-bottom-left"//提示位置
            // toast-top-full-width 顶端，宽度铺满整个屏幕
            // toast-top-right  顶端右边
        };

//    执行ajax删除
        function delAjax(id, obj){
            $.ajax({
                type: 'get',
                url: "index/cart/delete",
                data: {"id":id},
                dataType: 'json',
                success:function(data){
//            alert(data);
                    if (data.status){
                        toastr.success(data.info);
                        obj.remove();
                    }else{
                        toastr.error(data.info, 'error:');
                    }
                },
                error:function(){
                    alert('删除失败,请重试~');
                }
            });
        }

//        执行付款
           $('#settle').click(function(){
              alert('支付成功');
              location.href('index/index/index');
           });
    });
</script>
{/block}

</body>
</html>
